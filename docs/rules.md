# Rules

Этот документ фиксирует правила работы с проектом `fitness_app` (Python + PyQt6 + PyMySQL) и назначение папок/файлов.

## 1) Общие принципы

- **Точка входа одна**: приложение запускается только через `app/main.py`.
- **UI хранится в виде сырья**: в `qt_ui/` храним только исходные `.ui` файлы (Qt Designer). Сгенерированный Python-код из `.ui` в репозиторий не кладём.
- **Подключение к БД задано в коде**: параметры подключения находятся в `app/database/database.py` и в целом считаются “истиной проекта”. Локально разработчик может подстроить параметры под свою среду, **но такие изменения не коммитятся**.
- **Структура по ролям**: папки `app/admin`, `app/client`, `app/trainer`, `app/director` содержат UI и логику сценариев для соответствующих ролей.

## 2) Структура репозитория

Корень репозитория:

- **`app/`**

  - Основной код приложения (все runtime-модули).

- **`qt_ui/`**

  - Только исходники интерфейса Qt Designer: `.ui`.
  - Разрешено хранить:
    - `.ui`
    - (опционально) `.qrc` (если появятся ресурсы)
  - Запрещено коммитить:
    - сгенерированные `ui_*.py`
    - артефакты сборки

- **`docs/`**

  - Документация проекта.

- **`.venv/`**
  - Виртуальное окружение (не коммитится).

## 3) Папка `app/`

### 3.1 `app/main.py`

- **Назначение**: единственная точка входа.
- **Что делает**:
  - создаёт `QApplication`;
  - инициализирует зависимости (включая доступ к БД через `app/database`);
  - открывает стартовое окно (обычно `auth`/логин), далее — окна по роли.
- **Что не делает**:
  - не содержит SQL/запросов;
  - не содержит реализацию окон (только импорт/создание/показ).

### 3.2 `app/auth/`

- **Назначение**: экраны и сценарии, связанные с входом в систему.
- **Содержимое**:
  - `windows/` — окна PyQt (логин и т.п.);
  - `interfaces/` — интерфейсы/контракты (если вводите) между UI и логикой.

### 3.3 `app/admin/`, `app/client/`, `app/trainer/`, `app/director/`

- **Назначение**: UI и сценарии для каждой роли.
- **Содержимое**:
  - `windows/` — окна/страницы PyQt6;
  - `interfaces/` — интерфейсы/контракты (для разделения UI и сценарной логики).
- **Правило**: в этих папках допускается “сценарная логика” (логика действий пользователя), но без SQL.

### 3.4 `app/database/`

- **Назначение**: доступ к MySQL через PyMySQL.
- **Файлы**:
  - `database.py` — подключение и глобальный объект `db`.
  - `__init__.py` — публичный экспорт (`Database`, `db`).
- **Правила**:
  - В проекте используется единый объект `db`.
  - **Локальные изменения параметров подключения разрешены, но не коммитятся.**
  - Любой код, которому нужно подключение, получает его либо напрямую через `from app.database import db`, либо через внедрение зависимости (если вы так решите). Главное — не плодить отдельные подключения без причины.

### 3.5 `app/core/`

`core` — общие вещи, используемые в нескольких ролях/модулях.

- **`core/dao.py`**

  - Базовые классы для DAO/репозиториев.
  - Разрешено: общие методы работы с БД/курсор/выполнение запросов.
  - Запрещено: логика UI.

- **`core/dto/`**

  - DTO (структуры входа/выхода) для передачи данных между слоями/окнами/сценариями.
  - DTO не должны импортировать PyQt.

- **`core/enums.py`**
  - Общие перечисления (например, роли, статусы абонемента, статусы занятий), если они нужны в нескольких местах.

## 4) Правила зависимостей (кто кого может импортировать)

Чтобы проект не превратился в “клубок”, фиксируем правила:

- **`qt_ui/`**

  - не импортируется напрямую как python-пакет (это просто `.ui`).

- **UI-модули (`app/*/windows`)**

  - могут импортировать:
    - `app.core.dto`, `app.core.enums`
    - сценарную логику (если вы держите её рядом)
  - не должны:
    - выполнять SQL/создавать курсоры
    - напрямую писать в таблицы

- **DAO/доступ к данным (`app/core/dao.py`, будущие DAO)**

  - могут импортировать:
    - `app.database` (и использовать `db`/`Database`)
    - `app.core.enums`, `app.core.dto`
  - не должны:
    - импортировать PyQt

- **`app/database/*`**
  - ничего не знает про UI и роли.

## 5) Правила импортов (важно для стабильного запуска)

- Импорты делаем **от корня пакета `app`** (предпочтительно), чтобы не было “магии путей”:
  - правильно: `from app.database import db`
  - правильно: `from app.core.dao import BaseDAO`
  - нежелательно: `from database import Database`

Если вы запускаете приложение как модуль (рекомендуемо), то команда запуска будет вида:

- `python -m app.main`

(Команда запуска фиксируется в README позже, но архитектурно мы к этому стремимся.)

## 6) Правила работы с `.ui`

- `.ui` хранится в `qt_ui/`.
- В коде окна допускается:
  - загружать `.ui` на старте через `uic.loadUi(...)` (или аналогичный подход)
- Сгенерированные `ui_*.py` в репозиторий не добавляем.

## 7) Что коммитим и что не коммитим

- Коммитим:

  - весь код в `app/`
  - `.ui` в `qt_ui/`
  - документацию в `docs/`

- Не коммитим:
  - `.venv/`
  - `__pycache__/`
  - локальные изменения в `app/database/database.py` с параметрами подключения

## 8) Минимальные соглашения по именованию

- **Окна**: `SomethingWindow`, файл: `something_window.py`
- **DTO**: `SomethingDto`/`SomethingDTO` (главное — единообразно), файл: `something_dto.py`
- **DAO**: `SomethingDAO`, файл: `something_dao.py`
- **Enum**: `SomethingStatus`, файл: `enums.py` (или разнести по файлам при росте)
